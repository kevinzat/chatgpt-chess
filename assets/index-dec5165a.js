import{j as e,C as X,a as le}from"./chess-1a6ce67c.js";import{a as ce,r as o,R as de}from"./vendor-b1791c80.js";(function(){const l=document.createElement("link").relList;if(l&&l.supports&&l.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))m(a);new MutationObserver(a=>{for(const r of a)if(r.type==="childList")for(const g of r.addedNodes)g.tagName==="LINK"&&g.rel==="modulepreload"&&m(g)}).observe(document,{childList:!0,subtree:!0});function n(a){const r={};return a.integrity&&(r.integrity=a.integrity),a.referrerPolicy&&(r.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?r.credentials="include":a.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function m(a){if(a.ep)return;a.ep=!0;const r=n(a);fetch(a.href,r)}})();var J={},te=ce;J.createRoot=te.createRoot,J.hydrateRoot=te.hydrateRoot;/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var he={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const me=t=>t.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase().trim(),u=(t,l)=>{const n=o.forwardRef(({color:m="currentColor",size:a=24,strokeWidth:r=2,absoluteStrokeWidth:g,className:v="",children:f,...k},C)=>o.createElement("svg",{ref:C,...he,width:a,height:a,stroke:m,strokeWidth:g?Number(r)*24/Number(a):r,className:["lucide",`lucide-${me(t)}`,v].join(" "),...k},[...l.map(([j,w])=>o.createElement(j,w)),...Array.isArray(f)?f:[f]]));return n.displayName=`${t}`,n};/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const L=u("Bot",[["path",{d:"M12 8V4H8",key:"hb8ula"}],["rect",{width:"16",height:"12",x:"4",y:"8",rx:"2",key:"enze0r"}],["path",{d:"M2 14h2",key:"vft8re"}],["path",{d:"M20 14h2",key:"4cs60a"}],["path",{d:"M15 13v2",key:"1xurst"}],["path",{d:"M9 13v2",key:"rq6x2g"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xe=u("Check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ue=u("Copy",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pe=u("Crown",[["path",{d:"m2 4 3 12h14l3-12-6 7-4-7-4 7-6-7zm3 16h14",key:"zkxr6b"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ae=u("EyeOff",[["path",{d:"M9.88 9.88a3 3 0 1 0 4.24 4.24",key:"1jxqfv"}],["path",{d:"M10.73 5.08A10.43 10.43 0 0 1 12 5c7 0 10 7 10 7a13.16 13.16 0 0 1-1.67 2.68",key:"9wicm4"}],["path",{d:"M6.61 6.61A13.526 13.526 0 0 0 2 12s3 7 10 7a9.74 9.74 0 0 0 5.39-1.61",key:"1jreej"}],["line",{x1:"2",x2:"22",y1:"2",y2:"22",key:"a6p6uj"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ne=u("Eye",[["path",{d:"M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z",key:"rwhkz3"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const re=u("Loader2",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ge=u("Play",[["polygon",{points:"5 3 19 12 5 21 5 3",key:"191637"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fe=u("RotateCcw",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ye=u("Send",[["path",{d:"m22 2-7 20-4-9-9-4Z",key:"1q3vgg"}],["path",{d:"M22 2 11 13",key:"nzbqef"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const be=u("Settings",[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Q=u("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ve=u("XCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oe=u("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]),je=({game:t,moveHistory:l,apiKey:n,model:m,showDetails:a,onShowDetailsChange:r,onClose:g})=>{const[v,f]=o.useState([]),[k,C]=o.useState(""),[j,w]=o.useState(!1),p=o.useRef(null),E=()=>{var s;(s=p.current)==null||s.scrollIntoView({behavior:"smooth"})};o.useEffect(()=>{E()},[v]);const Z=()=>{const s={id:Date.now(),text:`e4

This opens up the center and develops your king's pawn, which is a fundamental opening principle. The move e4 controls important central squares and prepares for rapid development of your pieces.`,sender:"bot",timestamp:new Date().toLocaleTimeString(),details:{systemPrompt:`You are a chess expert and coach. You're analyzing a chess game and should provide helpful analysis, strategic advice, and suggest specific moves.

Current game state:
- FEN: ${t.fen()}
- Turn: ${t.turn()==="w"?"White":"Black"}
- Status: ${t.isCheckmate()?"Checkmate":t.isDraw()?"Draw":t.isCheck()?"Check":"Normal"}
- Move history: ${l.map(y=>y.san).join(", ")}

CRITICAL RESPONSE FORMAT:
When suggesting a move, ALWAYS start your response with the move in algebraic notation on its own line, like this:
"e4"

Then provide your explanation on the next line.

IMPORTANT INSTRUCTIONS:
1. When asked about the best move, suggest a specific move in algebraic notation (e.g., "e4", "Nf3", "O-O")
2. ALWAYS start your response with the move in algebraic notation on its own line
3. Always explain your reasoning for suggested moves
4. Analyze the current position and provide strategic insights
5. If the game is over, explain why and what led to the result
6. Be encouraging and educational in your responses

Provide helpful, educational responses about chess strategy, tactics, and the current position. Be encouraging and explain your reasoning. Keep responses concise but informative.`,userMessage:"What's the best move here?",gameState:{fen:t.fen(),turn:t.turn(),isCheck:t.isCheck(),isCheckmate:t.isCheckmate(),isDraw:t.isDraw(),moveHistory:l.map(y=>y.san)},requestBody:{message:"What's the best move here?",gameState:{fen:t.fen(),turn:t.turn(),isCheck:t.isCheck(),isCheckmate:t.isCheckmate(),isDraw:t.isDraw(),moveHistory:l.map(y=>y.san)},apiKey:"sk-..."}}};f([s])},G=async s=>{var T,$,z,q;if(!s.trim()||j)return;console.log("Sending message:",s);const y={id:Date.now(),text:s,sender:"user",timestamp:new Date().toLocaleTimeString()};f(x=>[...x,y]),C(""),w(!0);try{const x={fen:t.fen(),turn:t.turn(),isCheck:t.isCheck(),isCheckmate:t.isCheckmate(),isDraw:t.isDraw(),moveHistory:l.map(S=>S.san)},A=`You are a chess expert and coach. You're analyzing a chess game and should provide helpful analysis, strategic advice, and suggest specific moves.

Current game state:
- FEN: ${x.fen}
- Turn: ${x.turn==="w"?"White":"Black"}
- Status: ${x.isCheckmate?"Checkmate":x.isDraw?"Draw":x.isCheck?"Check":"Normal"}
- Move history: ${x.moveHistory.join(", ")}

CRITICAL RESPONSE FORMAT:
When suggesting a move, ALWAYS start your response with the move in algebraic notation on its own line, like this:
"e4"

Then provide your explanation on the next line.

IMPORTANT INSTRUCTIONS:
1. When asked about the best move, suggest a specific move in algebraic notation (e.g., "e4", "Nf3", "O-O")
2. ALWAYS start your response with the move in algebraic notation on its own line
3. Always explain your reasoning for suggested moves
4. Analyze the current position and provide strategic insights
5. If the game is over, explain why and what led to the result
6. Be encouraging and educational in your responses

Provide helpful, educational responses about chess strategy, tactics, and the current position. Be encouraging and explain your reasoning. Keep responses concise but informative.`,c=await fetch("https://api.openai.com/v1/chat/completions",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${n}`},body:JSON.stringify({model:m,messages:[{role:"system",content:A},{role:"user",content:s}],max_tokens:1e3,temperature:.7})});if(!c.ok){const S=await c.json().catch(()=>({}));throw new Error(`OpenAI API error: ${c.status} ${((T=S.error)==null?void 0:T.message)||"Unknown error"}`)}const d=((q=(z=($=(await c.json()).choices)==null?void 0:$[0])==null?void 0:z.message)==null?void 0:q.content)||"";console.log("Response from OpenAI:",d);const i={systemPrompt:A,userMessage:s,model:m,gameState:x},I={id:Date.now()+1,text:d,sender:"bot",timestamp:new Date().toLocaleTimeString(),details:{systemPrompt:A,userMessage:s,gameState:x,requestBody:i}};f(S=>[...S,I])}catch(x){console.error("Error sending message:",x);const A={id:Date.now()+1,text:"Sorry, I encountered an error. Please try again.",sender:"bot",timestamp:new Date().toLocaleTimeString(),isError:!0};f(c=>[...c,A])}finally{w(!1)}},F=s=>{s.preventDefault(),G(k)},W=["What's the best move here?","Analyze this position","What's my opponent's plan?","How can I improve my position?","What are the tactical opportunities?"],U=s=>s.details?e.jsxs("div",{className:"mt-3 p-3 bg-black/20 rounded-lg text-xs space-y-3 border border-gray-500",children:[e.jsx("div",{className:"text-center",children:e.jsx("span",{className:"text-yellow-400 font-bold",children:"ðŸ” DETAILED VIEW"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-blue-400 mb-1",children:"System Prompt:"}),e.jsx("pre",{className:"whitespace-pre-wrap text-gray-300 bg-black/30 p-2 rounded overflow-x-auto max-h-32 overflow-y-auto border border-gray-600",children:s.details.systemPrompt})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-blue-400 mb-1",children:"User Message:"}),e.jsx("div",{className:"bg-black/30 p-2 rounded border border-gray-600",children:s.details.userMessage})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-blue-400 mb-1",children:"Game State:"}),e.jsxs("div",{className:"bg-black/30 p-2 rounded space-y-1 border border-gray-600",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-400",children:"FEN:"})," ",e.jsx("code",{className:"text-blue-400 break-all",children:s.details.gameState.fen})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-400",children:"Turn:"})," ",s.details.gameState.turn==="w"?"White":"Black"]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-400",children:"Status:"})," ",s.details.gameState.isCheckmate?"Checkmate":s.details.gameState.isDraw?"Draw":s.details.gameState.isCheck?"Check":"Normal"]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-400",children:"Move History:"})," ",s.details.gameState.moveHistory.join(", ")||"None"]})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-blue-400 mb-1",children:"Request Body:"}),e.jsx("pre",{className:"whitespace-pre-wrap text-gray-300 bg-black/30 p-2 rounded overflow-x-auto max-h-32 overflow-y-auto border border-gray-600",children:JSON.stringify(s.details.requestBody,null,2)})]})]}):(console.log("No details for message:",s),null);return e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-gray-800 rounded-lg w-full max-w-2xl h-[70vh] flex flex-col border border-gray-600",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-600",children:[e.jsx("h2",{className:"text-xl font-bold text-white",children:"Chat with ChatGPT"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("button",{onClick:Z,className:"p-2 rounded bg-purple-600 hover:bg-purple-700 text-white",title:"Show Test Message",children:e.jsx(ge,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>r(!a),className:`p-2 rounded text-white ${a?"bg-green-600":"bg-gray-700 hover:bg-gray-600"}`,title:a?"Hide Details":"Show Details",children:a?e.jsx(ae,{className:"w-4 h-4"}):e.jsx(ne,{className:"w-4 h-4"})}),e.jsx("button",{onClick:g,className:"p-2 rounded bg-gray-700 hover:bg-gray-600 text-white",children:e.jsx(oe,{className:"w-4 h-4"})})]})]}),e.jsxs("div",{className:"p-4 bg-gray-700 border-b border-gray-600",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-sm text-white",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-300",children:"Turn:"}),e.jsx("span",{className:"ml-2 font-medium",children:t.turn()==="w"?"White":"Black"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-300",children:"Status:"}),e.jsx("span",{className:"ml-2 font-medium",children:t.isCheckmate()?"Checkmate":t.isDraw()?"Draw":t.isCheck()?"Check":"Normal"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-300",children:"Legal Moves:"}),e.jsx("span",{className:"ml-2 font-medium",children:t.moves().length})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-300",children:"Moves Made:"}),e.jsx("span",{className:"ml-2 font-medium",children:l.length})]})]}),e.jsxs("div",{className:"mt-2 pt-2 border-t border-gray-600",children:[e.jsx("span",{className:"text-gray-300 text-xs",children:"Current FEN:"}),e.jsx("div",{className:"text-xs font-mono text-blue-400 bg-black p-2 rounded mt-1 break-all",children:t.fen()})]}),e.jsxs("div",{className:"mt-2 pt-2 border-t border-gray-600",children:[e.jsx("span",{className:"text-gray-300 text-xs",children:"Move History:"}),e.jsx("div",{className:"text-xs font-mono text-green-400 bg-black p-2 rounded mt-1",children:l.map(s=>s.san).join(", ")||"No moves yet"})]})]}),e.jsxs("div",{className:"p-4 bg-gray-700 border-b border-gray-600",children:[e.jsx("p",{className:"text-sm text-gray-300 mb-2",children:"Quick questions:"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:W.map((s,y)=>e.jsx("button",{onClick:()=>G(s),disabled:j,className:"text-xs bg-gray-600 hover:bg-gray-500 px-3 py-1 rounded-full transition-colors disabled:opacity-50 text-white",children:s},y))})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-4",children:[v.length===0?e.jsxs("div",{className:"text-center text-gray-400 py-8",children:[e.jsx(L,{className:"w-12 h-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"Ask me anything about the current position!"}),e.jsx("p",{className:"text-xs mt-2",children:"Click the purple play button to see a test message with details"}),e.jsx("p",{className:"text-xs mt-1",children:"Or ask a question to see real ChatGPT prompts and responses"})]}):v.map(s=>e.jsxs("div",{children:[e.jsx("div",{className:`flex ${s.sender==="user"?"justify-end":"justify-start"}`,children:e.jsxs("div",{className:`flex items-start space-x-2 max-w-[80%] ${s.sender==="user"?"flex-row-reverse space-x-reverse":""}`,children:[e.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center ${s.sender==="user"?"bg-blue-500":"bg-gray-600"}`,children:s.sender==="user"?e.jsx(Q,{className:"w-4 h-4 text-white"}):e.jsx(L,{className:"w-4 h-4 text-white"})}),e.jsxs("div",{className:`rounded-lg px-3 py-2 ${s.sender==="user"?"bg-blue-500 text-white":s.isError?"bg-red-500/20 text-red-200":"bg-gray-600 text-white"}`,children:[e.jsx("p",{className:"text-sm whitespace-pre-wrap",children:s.text}),e.jsx("p",{className:"text-xs opacity-60 mt-1",children:s.timestamp})]})]})}),s.sender==="bot"&&a&&U(s)]},s.id)),j&&e.jsx("div",{className:"flex justify-start",children:e.jsxs("div",{className:"flex items-start space-x-2",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-gray-600 flex items-center justify-center",children:e.jsx(L,{className:"w-4 h-4 text-white"})}),e.jsx("div",{className:"bg-gray-600 rounded-lg px-3 py-2",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(re,{className:"w-4 h-4 animate-spin text-white"}),e.jsx("span",{className:"text-sm text-white",children:"Thinking..."})]})})]})}),e.jsx("div",{ref:p})]}),e.jsxs("form",{onSubmit:F,className:"flex space-x-2 p-4 border-t border-gray-600",children:[e.jsx("input",{type:"text",value:k,onChange:s=>C(s.target.value),placeholder:"Ask about the position, strategy, or anything chess-related...",disabled:j,className:"flex-1 px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 disabled:opacity-50 text-white"}),e.jsx("button",{type:"submit",disabled:!k.trim()||j,className:"bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded transition-colors disabled:opacity-50",children:e.jsx(ye,{className:"w-4 h-4"})})]})]})})},we=({apiKey:t,model:l})=>{const[n,m]=o.useState(new X),[a,r]=o.useState([]),[g,v]=o.useState(!1),[f,k]=o.useState(!1),[C,j]=o.useState(!1),[w,p]=o.useState("playing"),[E,Z]=o.useState(!0),[G,F]=o.useState(new Set),[W,U]=o.useState(!1),[s,y]=o.useState(!1),T=o.useCallback(c=>{const h=new X(n.fen()),d=h.move(c);return m(h),d},[n]),$=o.useCallback(async()=>{var c,h,d,i,I,S;if(!(!E||n.isGameOver()||n.isDraw()||n.turn()==="w")){v(!0),await new Promise(M=>setTimeout(M,500));try{const M=n.moves();if(M.length===0)return;const P=[];for(let b=0;b<a.length;b+=2){const Y=Math.floor(b/2)+1,D=((c=a[b])==null?void 0:c.san)||"",se=((h=a[b+1])==null?void 0:h.san)||"";D&&P.push(`${Y}. ${D}${se?` ${se}`:""}`)}const K=`You are a chess expert playing as Black. You must suggest the best move for Black in algebraic notation (e.g., "e5" or "Nf6") and explain your reasoning.

IMPORTANT: Start your response with the move in algebraic notation on its own line, then provide your explanation.`,H=`I am playing as Black in a chess game. 
Move history: ${P.join(" ")}
Please suggest the best move for Black in algebraic notation (e.g., "e5" or "Nf6") and explain your reasoning.`,N=await fetch("https://api.openai.com/v1/chat/completions",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`},body:JSON.stringify({model:l,messages:[{role:"system",content:K},{role:"user",content:H}],max_tokens:500,temperature:.7})});if(!N.ok){const b=await N.json().catch(()=>({}));throw new Error(`OpenAI API error: ${N.status} ${((d=b.error)==null?void 0:d.message)||"Unknown error"}`)}const B=((S=(I=(i=(await N.json()).choices)==null?void 0:i[0])==null?void 0:I.message)==null?void 0:S.content)||"",ie={systemPrompt:K,userMessage:H,model:l,gameState:{moveHistory:P}};let R=null,ee=!1,V=null;if(B){const Y=B.trim().split(`
`)[0].trim(),D=Y.match(/\b([a-h][1-8]|[a-h]x[a-h][1-8]|[KQRBN]?[a-h]?[1-8]?x?[a-h][1-8]|[O-O-O]|[O-O])\b/);D?M.includes(D[1])?(R=D[1],console.log("Found valid move on first line:",R)):(console.log("Move "+Y+" not in possible moves"),console.log("ChatGPT response for AI move:",B),V="not-legal-move"):(console.log("No move found in first line"),console.log("ChatGPT response for AI move:",B),V="no-move-found")}if(!R){const b=Math.floor(Math.random()*M.length);R=M[b],ee=!0,console.log("Using random move as fallback:",R)}const O=T(R);O&&r(b=>[...b,{from:O.from,to:O.to,piece:O.piece,color:O.color,san:O.san,isAI:!0,chatgptResponse:B,usedRandomMoveFallback:ee,fallbackErrorType:V,requestBody:ie}])}catch(M){console.error("Error making AI move:",M);const P=n.moves();if(P.length>0){const K=Math.floor(Math.random()*P.length),H=P[K],N=T(H);N&&r(_=>[..._,{from:N.from,to:N.to,piece:N.piece,color:N.color,san:N.san,isAI:!0,chatgptResponse:"Error: Using random move as fallback",usedRandomMoveFallback:!0,fallbackErrorType:null,requestBody:null}])}}finally{v(!1)}}},[n,E,T,t,l,a]),z=(c,h)=>{if(n.turn()!=="w"||g)return!1;const d=T({from:c,to:h,promotion:"q"});return d===null?!1:(r(i=>[...i,{from:c,to:h,piece:d.piece,color:d.color,san:d.san,isAI:!1}]),!0)},q=()=>{m(new X),r([]),p("playing"),F(new Set)},x=c=>{F(h=>{const d=new Set(h);return d.has(c)?d.delete(c):d.add(c),d})},A=()=>n.isCheckmate()?"Checkmate!":n.isDraw()?"Draw!":n.isStalemate()?"Stalemate!":n.isCheck()?"Check!":n.turn()==="w"?"White to move":"Black to move";return o.useEffect(()=>{E&&n.turn()==="b"&&!n.isGameOver()&&!n.isDraw()&&$()},[n.turn(),E,$]),o.useEffect(()=>{p(A())},[n]),e.jsx("div",{children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[e.jsx("div",{className:"lg:col-span-2",children:e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h2",{className:"text-xl font-bold",children:"Chess Board"}),e.jsx("div",{className:"flex space-x-2",children:e.jsxs("button",{onClick:q,className:"btn-secondary flex items-center space-x-2",children:[e.jsx(fe,{className:"w-4 h-4"}),e.jsx("span",{children:"Reset"})]})})]}),e.jsx("div",{className:"flex justify-center mb-4",children:e.jsx("div",{className:"w-full max-w-md",children:e.jsx(le,{position:n.fen(),onPieceDrop:z,boardOrientation:"white",draggable:!0,snapToCursor:!0,customBoardStyle:{borderRadius:"8px",boxShadow:"0 4px 6px -1px rgba(0, 0, 0, 0.1)"}})})}),e.jsxs("div",{className:"text-center space-y-2",children:[g&&e.jsxs("div",{className:"inline-flex items-center space-x-2 bg-chess-warning/20 text-chess-warning rounded-lg px-4 py-2",children:[e.jsx(re,{className:"w-4 h-4 animate-spin"}),e.jsx("span",{className:"text-sm font-medium",children:"AI is thinking..."})]}),e.jsxs("div",{className:"inline-flex items-center space-x-2 bg-white/10 rounded-lg px-4 py-2",children:[e.jsx("span",{className:"text-sm font-medium",children:"Status:"}),e.jsx("span",{className:`text-sm ${w.includes("Checkmate")?"text-chess-error":w.includes("Draw")||w.includes("Check")?"text-chess-warning":"text-chess-success"}`,children:w})]})]})]})}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"card",children:[e.jsx("h3",{className:"text-lg font-bold mb-4",children:"Game Info"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-300",children:"Current Turn:"}),e.jsx("div",{className:"flex items-center space-x-2",children:n.turn()==="w"?e.jsxs(e.Fragment,{children:[e.jsx(Q,{className:"w-4 h-4 text-white"}),e.jsx("span",{className:"text-sm",children:"White (You)"})]}):e.jsxs(e.Fragment,{children:[e.jsx(L,{className:"w-4 h-4 text-chess-accent"}),e.jsx("span",{className:"text-sm",children:"Black (AI)"})]})})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-300",children:"Moves Made:"}),e.jsx("span",{className:"text-sm font-medium",children:a.length})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-300",children:"FEN:"}),e.jsx("button",{type:"button",className:"text-xs text-gray-400 font-mono bg-transparent border-none p-0 m-0 truncate max-w-32 hover:text-blue-400 focus:outline-none",style:{maxWidth:"8rem",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},onClick:()=>U(c=>!c),title:W?"Click to collapse":"Click to expand",children:n.fen()})]}),W&&e.jsxs("div",{className:"mt-1 p-2 bg-gray-800/70 rounded text-xs text-blue-300 font-mono break-all flex items-center justify-between",children:[e.jsx("span",{children:n.fen()}),e.jsx("button",{type:"button",className:"ml-2 p-1 rounded hover:bg-gray-700 transition-colors",onClick:async()=>{await navigator.clipboard.writeText(n.fen()),y(!0),setTimeout(()=>y(!1),1200)},title:"Copy FEN to clipboard",children:s?e.jsx(xe,{className:"w-4 h-4 text-green-400"}):e.jsx(ue,{className:"w-4 h-4 text-blue-300"})})]})]})]}),e.jsxs("div",{className:"card",children:[e.jsx("h3",{className:"text-lg font-bold mb-4",children:"Move History"}),e.jsx("div",{className:"max-h-64 overflow-y-auto space-y-2",children:a.length===0?e.jsx("p",{className:"text-sm text-gray-400 text-center py-4",children:"No moves yet"}):Array.from({length:Math.ceil(a.length/2)}).map((c,h)=>{const d=a[h*2],i=a[h*2+1],I=h*2+1;return e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"grid grid-cols-3 gap-2 items-center text-sm",children:[e.jsxs("span",{className:"text-gray-300 text-center",children:[h+1,"."]}),e.jsx("span",{className:"font-mono flex items-center justify-center space-x-1 min-h-[1.5em]",children:d?e.jsxs(e.Fragment,{children:[e.jsx("span",{children:d.san}),e.jsx(Q,{className:"w-3 h-3 text-white"})]}):null}),e.jsx("span",{className:"font-mono flex items-center justify-center space-x-1 min-h-[1.5em]",children:i?e.jsxs(e.Fragment,{children:[e.jsx("span",{children:i.san}),e.jsx("button",{type:"button",className:`focus:outline-none ${i.isAI&&i.chatgptResponse?"cursor-pointer":"cursor-default"}`,onClick:()=>{i.isAI&&i.chatgptResponse&&x(I)},tabIndex:i.isAI&&i.chatgptResponse?0:-1,"aria-label":"Show/Hide ChatGPT explanation",children:i.usedRandomMoveFallback?e.jsx(ve,{className:"w-4 h-4 text-red-500 hover:scale-125 transition-transform"}):e.jsx(L,{className:`w-3 h-3 text-chess-accent ${i.isAI&&i.chatgptResponse?"hover:scale-125 transition-transform":""}`})})]}):null})]}),i&&i.isAI&&i.chatgptResponse&&G.has(I)&&e.jsx("div",{className:"ml-8",children:e.jsxs("div",{className:"text-xs text-gray-400 bg-gray-800/50 rounded p-2 mt-1",children:[e.jsxs("div",{className:"font-medium text-chess-accent mb-1 flex items-center gap-2",children:[!i.usedRandomMoveFallback&&e.jsx("span",{children:"ChatGPT:"}),i.usedRandomMoveFallback&&i.fallbackErrorType==="no-move-found"&&e.jsxs("span",{children:["ChatGPT ",e.jsx("span",{className:"text-xs text-red-400",children:"(does not start with a move)"}),":"]}),i.usedRandomMoveFallback&&i.fallbackErrorType==="not-legal-move"&&e.jsxs("span",{children:["ChatGPT ",e.jsx("span",{className:"text-xs text-red-400",children:"(not a legal move)"}),":"]})]}),e.jsx("div",{className:"text-gray-300",children:i.chatgptResponse})]})})]},h)})})]})]}),f&&e.jsx(je,{game:n,moveHistory:a,apiKey:t,model:l,showDetails:C,onShowDetailsChange:j,onClose:()=>k(!1)})]})})},Ne=({onSettingsClick:t})=>e.jsx("header",{className:"bg-black/20 backdrop-blur-sm border-b border-white/10",children:e.jsx("div",{className:"container mx-auto px-4 py-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(pe,{className:"w-8 h-8 text-chess-accent"}),e.jsx("h1",{className:"text-2xl font-bold text-white",children:"Chess vs ChatGPT"})]}),e.jsx("button",{onClick:t,className:"p-2 rounded-lg bg-white/10 hover:bg-white/20 transition-colors duration-200",title:"Settings",children:e.jsx(be,{className:"w-5 h-5 text-white"})})]})})}),ke=({apiKey:t,model:l,onApiKeyChange:n,onModelChange:m,onClose:a})=>{const[r,g]=o.useState(!1),[v,f]=o.useState(t),[k,C]=o.useState(l),j=()=>{n(v),m(k),a()},w=[{value:"gpt-3.5-turbo",label:"GPT-3.5 Turbo"},{value:"gpt-3.5-turbo-16k",label:"GPT-3.5 Turbo 16K"},{value:"gpt-4",label:"GPT-4"},{value:"gpt-4-turbo",label:"GPT-4 Turbo"},{value:"gpt-4-turbo-preview",label:"GPT-4 Turbo Preview"},{value:"gpt-4o",label:"GPT-4o"},{value:"gpt-4o-mini",label:"GPT-4o Mini"}];return e.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50",children:e.jsxs("div",{className:"card max-w-md w-full mx-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h2",{className:"text-xl font-bold",children:"Settings"}),e.jsx("button",{onClick:a,className:"p-1 rounded hover:bg-white/10 transition-colors",children:e.jsx(oe,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"OpenAI API Key"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:r?"text":"password",value:v,onChange:p=>f(p.target.value),placeholder:"sk-...",className:"w-full px-3 py-2 bg-white/10 border border-white/20 rounded-lg focus:outline-none focus:ring-2 focus:ring-chess-accent"}),e.jsx("button",{type:"button",onClick:()=>g(!r),className:"absolute right-3 top-1/2 transform -translate-y-1/2 p-1 hover:bg-white/10 rounded",children:r?e.jsx(ae,{className:"w-4 h-4"}):e.jsx(ne,{className:"w-4 h-4"})})]}),e.jsx("p",{className:"text-xs text-gray-400 mt-1",children:"Your API key is stored locally and never sent to our servers."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"OpenAI Model"}),e.jsx("select",{value:k,onChange:p=>C(p.target.value),className:"w-full px-3 py-2 bg-white/10 border border-white/20 rounded-lg focus:outline-none focus:ring-2 focus:ring-chess-accent",children:w.map(p=>e.jsx("option",{value:p.value,children:p.label},p.value))}),e.jsx("p",{className:"text-xs text-gray-400 mt-1",children:"Choose the AI model that will play against you."})]}),e.jsxs("div",{className:"flex space-x-3 pt-4",children:[e.jsx("button",{onClick:a,className:"btn-secondary flex-1",children:"Cancel"}),e.jsx("button",{onClick:j,className:"btn-primary flex-1",children:"Save"})]})]})]})})};function Ce(){const[t,l]=o.useState(""),[n,m]=o.useState("gpt-3.5-turbo"),[a,r]=o.useState(!1);return e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-chess-dark to-gray-900",children:[e.jsx(Ne,{onSettingsClick:()=>r(!0)}),e.jsx("main",{className:"container mx-auto px-4 py-8",children:t?e.jsx(we,{apiKey:t,model:n}):e.jsx("div",{className:"flex items-center justify-center min-h-[60vh]",children:e.jsxs("div",{className:"card max-w-md w-full text-center",children:[e.jsx("h2",{className:"text-2xl font-bold mb-4",children:"Welcome to Chess vs ChatGPT"}),e.jsx("p",{className:"mb-6 text-gray-300",children:"To start playing, you'll need to enter your OpenAI API key and select a model."}),e.jsx("button",{onClick:()=>r(!0),className:"btn-primary",children:"Enter API Key & Select Model"})]})})}),a&&e.jsx(ke,{apiKey:t,model:n,onApiKeyChange:l,onModelChange:m,onClose:()=>r(!1)})]})}J.createRoot(document.getElementById("root")).render(e.jsx(de.StrictMode,{children:e.jsx(Ce,{})}));
